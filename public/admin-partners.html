<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quáº£n lÃ½ Äá»‘i tÃ¡c - Admin</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y2NK9VB75H"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-Y2NK9VB75H');
    </script>

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-styles.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        /* Enhanced tab styling */
        .tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 0.7rem 1.5rem;
            border: 2px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .tab-btn:hover::before {
            left: 100%;
        }

        .tab-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.15);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }

        .tab-btn.active:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,123,255,0.4);
        }
    </style>
</head>
<body>
    <nav class="admin-nav">
        <div class="admin-nav-container">
            <div class="admin-logo">ATLÄ Connect Admin</div>
            <div class="admin-nav-menu">
                <a href="admin-dashboard.html">Dashboard</a>
                <a href="admin-partners.html" class="active">Äá»‘i tÃ¡c</a>
                <a href="admin-requests.html">Tin Ä‘Ã o táº¡o</a>
                <a href="admin-documents.html">TÃ i liá»‡u</a>
                <button id="logout-btn" class="btn btn-small btn-secondary">ÄÄƒng xuáº¥t</button>
            </div>
        </div>
    </nav>

    <div class="admin-container">
        <div class="admin-header">
            <h1>Quáº£n lÃ½ Äá»‘i tÃ¡c</h1>
            <p>PhÃª duyá»‡t vÃ  quáº£n lÃ½ Ä‘á»‘i tÃ¡c Ä‘Ã o táº¡o</p>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn" onclick="switchTab('pending')">â³ Chá» duyá»‡t</button>
            <button class="tab-btn" onclick="switchTab('approved')">âœ“ ÄÃ£ duyá»‡t</button>
            <button class="tab-btn active" onclick="switchTab('all')">ğŸ“‹ Táº¥t cáº£</button>
            <button class="tab-btn" onclick="switchTab('emails')">ğŸ“§ Email ThÃ´ng bÃ¡o</button>
        </div>

        <!-- Partners List View -->
        <div id="partners-view" class="data-table-container">
            <div class="loading-spinner" id="loading">Äang táº£i...</div>
            <div id="partners-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;"></div>
            <div id="no-data" style="display: none;">KhÃ´ng cÃ³ dá»¯ liá»‡u</div>
        </div>

        <!-- Email Management View -->
        <div id="emails-view" style="display: none;">
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1.5rem; color: var(--primary-color);">ğŸ“§ Quáº£n lÃ½ Email Nháº­n ThÃ´ng bÃ¡o</h3>
                <p style="margin-bottom: 1.5rem; color: var(--gray-color);">Danh sÃ¡ch email sáº½ nháº­n thÃ´ng bÃ¡o tá»± Ä‘á»™ng khi cÃ³ yÃªu cáº§u Ä‘Ã o táº¡o má»›i.</p>

                <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <input type="email" id="new-email-input" placeholder="Nháº­p email má»›i (VD: partner@example.com)"
                        style="flex: 1; padding: 0.75rem 1rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95rem;"
                        onkeypress="if(event.key==='Enter') addNotificationEmail()">
                    <button class="btn btn-primary" onclick="addNotificationEmail()" style="padding: 0.75rem 1.5rem; font-weight: 600; white-space: nowrap;">
                        â• ThÃªm Email
                    </button>
                </div>

                <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 2rem;">
                    <strong>ğŸ’¡ LÆ°u Ã½:</strong> Há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng láº¥y email tá»« Ä‘á»‘i tÃ¡c Ä‘Ã£ Ä‘Äƒng kÃ½. Báº¡n cÃ³ thá»ƒ thÃªm email thá»§ cÃ´ng táº¡i Ä‘Ã¢y.
                </div>

                <div id="loading-emails" class="loading-spinner" style="display: none;">Äang táº£i...</div>
                <div id="emails-list"></div>
            </div>
        </div>
    </div>

    <!-- Modal for partner details -->
    <div id="detail-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; padding: 2rem;" onclick="if(event.target === this) closeDetailModal()">
        <div style="max-width: 700px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 16px; max-height: 85vh; overflow-y: auto; position: relative; box-shadow: 0 8px 32px rgba(0,0,0,0.2);">
            <button onclick="closeDetailModal()" style="position: absolute; top: 1rem; right: 1rem; background: #f0f0f0; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; line-height: 1; color: #666; transition: all 0.2s;" onmouseover="this.style.background='#e0e0e0'" onmouseout="this.style.background='#f0f0f0'">Ã—</button>
            <div id="modal-content"></div>
        </div>
    </div>

    <script src="firebase-config.js"></script>
    <script>
        window.FirebaseHelper.onAuthStateChanged((user) => {
            if (!user) {
                window.location.href = 'admin-login.html';
            }
        });

        document.getElementById('logout-btn').addEventListener('click', async () => {
            await window.FirebaseHelper.signOutAdmin();
            window.location.href = 'admin-login.html';
        });

        let currentTab = 'all';
        let allPartners = [];

        async function loadPartners() {
            const loading = document.getElementById('loading');
            const partnersList = document.getElementById('partners-list');
            const noData = document.getElementById('no-data');

            loading.style.display = 'block';
            partnersList.innerHTML = '';
            noData.style.display = 'none';

            try {
                const snapshot = await firebase.firestore()
                    .collection('partners')
                    .orderBy('createdAt', 'desc')
                    .get();

                allPartners = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                renderPartners();
            } catch (error) {
                console.error('Error loading partners:', error);
                loading.style.display = 'none';
                partnersList.innerHTML = `<p style="color: red; grid-column: 1/-1;">CÃ³ lá»—i xáº£y ra: ${error.message}</p>`;
                noData.style.display = 'block';
            }
        }

        function renderPartners() {
            const loading = document.getElementById('loading');
            const partnersList = document.getElementById('partners-list');
            const noData = document.getElementById('no-data');

            loading.style.display = 'none';

            let filtered = allPartners;
            if (currentTab === 'pending') {
                filtered = allPartners.filter(p => p.status === 'pending');
            } else if (currentTab === 'approved') {
                filtered = allPartners.filter(p => p.status === 'approved');
            }

            if (filtered.length === 0) {
                partnersList.innerHTML = '';
                noData.style.display = 'block';
                return;
            }

            noData.style.display = 'none';
            partnersList.innerHTML = '';

            filtered.forEach(partner => {
                const date = partner.createdAt ? new Date(partner.createdAt.toDate()).toLocaleDateString('vi-VN') : 'N/A';

                // Determine border color based on status
                let borderColor = '#6c757d'; // gray for rejected/other
                if (partner.status === 'pending') borderColor = '#ffc107'; // yellow
                if (partner.status === 'approved' && partner.subscriptionStatus === 'active') borderColor = '#28a745'; // green
                if (partner.status === 'approved' && partner.subscriptionStatus === 'inactive') borderColor = '#007bff'; // blue

                const card = document.createElement('div');
                card.className = 'partner-card';
                card.style.cssText = `background: white; padding: 1.25rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-top: 4px solid ${borderColor}; cursor: pointer; transition: all 0.3s; height: fit-content;`;
                card.onmouseover = () => card.style.boxShadow = '0 4px 16px rgba(0,0,0,0.15)';
                card.onmouseout = () => card.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';

                card.innerHTML = `
                    <div style="margin-bottom: 1rem;">
                        <div style="font-size: 1rem; font-weight: 600; color: var(--dark-color); margin-bottom: 0.5rem;">${partner.companyName}</div>
                        <div style="font-size: 0.85rem; color: var(--gray-color);">${partner.accountType === 'company' ? 'ğŸ¢ Doanh nghiá»‡p' : 'ğŸ‘¤ CÃ¡ nhÃ¢n'} - ${partner.accountType === 'company' ? '999k/nÄƒm' : '199k/nÄƒm'}</div>
                    </div>

                    <div style="font-size: 0.9rem; color: var(--gray-color); margin-bottom: 1rem; line-height: 1.6;">
                        <div style="margin-bottom: 0.4rem;"><strong>${partner.contactName}</strong></div>
                        <div style="margin-bottom: 0.4rem;">ğŸ“ ${partner.phone}</div>
                        <div style="margin-bottom: 0.4rem;">ğŸ“§ ${partner.email}</div>
                        <div style="margin-bottom: 0.4rem;">ğŸ“… ${date}</div>
                    </div>

                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                        ${partner.status === 'approved'
                            ? '<span class="status-badge status-success" style="font-size: 0.75rem;">âœ“ ÄÃ£ duyá»‡t</span>'
                            : partner.status === 'pending'
                            ? '<span class="status-badge status-warning" style="font-size: 0.75rem;">â³ Chá» duyá»‡t</span>'
                            : '<span class="status-badge status-danger" style="font-size: 0.75rem;">âœ— Tá»« chá»‘i</span>'}

                        ${partner.subscriptionStatus === 'active'
                            ? '<span class="status-badge status-success" style="font-size: 0.75rem;">ğŸŸ¢ Active</span>'
                            : '<span class="status-badge status-danger" style="font-size: 0.75rem;">ğŸ”´ Inactive</span>'}
                    </div>

                    <button class="btn btn-primary" onclick="event.stopPropagation(); viewPartner('${partner.id}')" style="width: 100%; padding: 0.65rem; font-size: 0.9rem; margin-bottom: 0.75rem; font-weight: 600; border-radius: 8px; transition: all 0.2s;">
                        ğŸ‘ï¸ Xem chi tiáº¿t
                    </button>

                    <div style="display: grid; grid-template-columns: ${partner.status === 'pending' ? '1fr 1fr' : '1fr'}; gap: 0.5rem;">
                        ${partner.status === 'pending' ? `
                            <button class="btn btn-small btn-success" onclick="event.stopPropagation(); approvePartner('${partner.id}')" style="width: 100%; font-size: 0.85rem; padding: 0.55rem; font-weight: 600; border-radius: 6px;">âœ“ Duyá»‡t</button>
                            <button class="btn btn-small btn-danger" onclick="event.stopPropagation(); rejectPartner('${partner.id}')" style="width: 100%; font-size: 0.85rem; padding: 0.55rem; font-weight: 600; border-radius: 6px;">âœ— Tá»« chá»‘i</button>
                        ` : partner.status === 'approved' && partner.subscriptionStatus === 'inactive' ? `
                            <button class="btn btn-small btn-primary" onclick="event.stopPropagation(); activateSubscription('${partner.id}')" style="width: 100%; font-size: 0.85rem; padding: 0.55rem; font-weight: 600; border-radius: 6px;">âš¡ KÃ­ch hoáº¡t Sub</button>
                        ` : ''}
                    </div>
                `;
                partnersList.appendChild(card);
            });
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'emails') {
                document.getElementById('partners-view').style.display = 'none';
                document.getElementById('emails-view').style.display = 'block';
                loadNotificationEmails();
            } else {
                document.getElementById('partners-view').style.display = 'block';
                document.getElementById('emails-view').style.display = 'none';
                renderPartners();
            }
        }

        // Email Management Functions
        async function loadNotificationEmails() {
            const loadingEmails = document.getElementById('loading-emails');
            const emailsList = document.getElementById('emails-list');

            loadingEmails.style.display = 'block';
            emailsList.innerHTML = '';

            try {
                // Get manual emails
                const manualSnapshot = await firebase.firestore()
                    .collection('notificationEmails')
                    .orderBy('createdAt', 'desc')
                    .get();

                const manualEmails = manualSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    source: 'manual'
                }));

                // Get partner emails (approved & active)
                const partnersSnapshot = await firebase.firestore()
                    .collection('partners')
                    .where('status', '==', 'approved')
                    .where('subscriptionStatus', '==', 'active')
                    .get();

                const partnerEmails = partnersSnapshot.docs.map(doc => {
                    const data = doc.data();
                    return {
                        id: doc.id,
                        email: data.email,
                        companyName: data.companyName,
                        source: 'partner',
                        createdAt: data.createdAt
                    };
                });

                // Combine and deduplicate
                const allEmails = [...manualEmails, ...partnerEmails];
                const uniqueEmails = Array.from(new Map(allEmails.map(e => [e.email, e])).values());

                loadingEmails.style.display = 'none';

                if (uniqueEmails.length === 0) {
                    emailsList.innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 2rem;">ChÆ°a cÃ³ email nÃ o trong danh sÃ¡ch.</p>';
                    return;
                }

                emailsList.innerHTML = `
                    <div style="display: grid; gap: 1rem;">
                        <div style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 100px; gap: 1rem; padding: 1rem; background: var(--light-color); border-radius: 8px; font-weight: 600;">
                            <div>Email</div>
                            <div>Nguá»“n</div>
                            <div>NgÃ y thÃªm</div>
                            <div>Thao tÃ¡c</div>
                        </div>
                        ${uniqueEmails.map(item => {
                            const date = item.createdAt ? new Date(item.createdAt.toDate()).toLocaleDateString('vi-VN') : 'N/A';
                            const sourceLabel = item.source === 'manual'
                                ? 'âœï¸ Thá»§ cÃ´ng'
                                : `ğŸ¢ ${item.companyName || 'Äá»‘i tÃ¡c'}`;
                            const canDelete = item.source === 'manual';

                            return `
                                <div style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 100px; gap: 1rem; padding: 1rem; background: white; border-radius: 8px; align-items: center; border: 1px solid #e0e0e0;">
                                    <div style="font-weight: 600; color: var(--primary-color);">${item.email}</div>
                                    <div style="font-size: 0.9rem; color: var(--gray-color);">${sourceLabel}</div>
                                    <div style="font-size: 0.9rem; color: var(--gray-color);">${date}</div>
                                    <div>
                                        ${canDelete
                                            ? `<button class="btn btn-small btn-danger" onclick="deleteNotificationEmail('${item.id}')" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">ğŸ—‘ï¸ XÃ³a</button>`
                                            : '<span style="color: var(--gray-color); font-size: 0.85rem;">-</span>'}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div style="margin-top: 1.5rem; padding: 1rem; background: #d4edda; border-radius: 8px; border-left: 4px solid #28a745;">
                        <strong>âœ“ Tá»•ng cá»™ng:</strong> ${uniqueEmails.length} email sáº½ nháº­n thÃ´ng bÃ¡o (${partnerEmails.length} tá»« Ä‘á»‘i tÃ¡c, ${manualEmails.length} thÃªm thá»§ cÃ´ng)
                    </div>
                `;

            } catch (error) {
                console.error('Error loading emails:', error);
                loadingEmails.style.display = 'none';
                emailsList.innerHTML = `<p style="color: red; text-align: center; padding: 2rem;">CÃ³ lá»—i xáº£y ra: ${error.message}</p>`;
            }
        }

        async function addNotificationEmail() {
            const input = document.getElementById('new-email-input');
            const email = input.value.trim();

            if (!email) {
                alert('Vui lÃ²ng nháº­p email!');
                return;
            }

            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Email khÃ´ng há»£p lá»‡!');
                return;
            }

            try {
                // Check if email already exists
                const existing = await firebase.firestore()
                    .collection('notificationEmails')
                    .where('email', '==', email)
                    .get();

                if (!existing.empty) {
                    alert('Email nÃ y Ä‘Ã£ tá»“n táº¡i trong danh sÃ¡ch!');
                    return;
                }

                await firebase.firestore().collection('notificationEmails').add({
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    addedBy: firebase.auth().currentUser.email
                });

                input.value = '';
                alert('âœ“ ÄÃ£ thÃªm email thÃ nh cÃ´ng!');
                loadNotificationEmails();
            } catch (error) {
                alert('Lá»—i: ' + error.message);
            }
        }

        async function deleteNotificationEmail(emailId) {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a email nÃ y?')) return;

            try {
                await firebase.firestore()
                    .collection('notificationEmails')
                    .doc(emailId)
                    .delete();

                alert('âœ“ ÄÃ£ xÃ³a email!');
                loadNotificationEmails();
            } catch (error) {
                alert('Lá»—i: ' + error.message);
            }
        }

        async function approvePartner(partnerId) {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n duyá»‡t Ä‘á»‘i tÃ¡c nÃ y?')) return;

            try {
                await firebase.firestore().collection('partners').doc(partnerId).update({
                    status: 'approved',
                    approvedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert('ÄÃ£ duyá»‡t Ä‘á»‘i tÃ¡c! HÃ£y kÃ­ch hoáº¡t subscription Ä‘á»ƒ há» cÃ³ thá»ƒ Ä‘Äƒng nháº­p.');
                loadPartners();
            } catch (error) {
                alert('Lá»—i: ' + error.message);
            }
        }

        async function rejectPartner(partnerId) {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n tá»« chá»‘i Ä‘á»‘i tÃ¡c nÃ y?')) return;

            try {
                await firebase.firestore().collection('partners').doc(partnerId).update({
                    status: 'rejected',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert('ÄÃ£ tá»« chá»‘i Ä‘á»‘i tÃ¡c!');
                loadPartners();
            } catch (error) {
                alert('Lá»—i: ' + error.message);
            }
        }

        async function activateSubscription(partnerId) {
            const duration = prompt('KÃ­ch hoáº¡t bao nhiÃªu thÃ¡ng? (VD: 12 cho 1 nÄƒm)');
            if (!duration || isNaN(duration)) return;

            try {
                const startDate = new Date();
                const endDate = new Date();
                endDate.setMonth(endDate.getMonth() + parseInt(duration));

                await firebase.firestore().collection('partners').doc(partnerId).update({
                    subscriptionStatus: 'active',
                    subscriptionStartDate: firebase.firestore.Timestamp.fromDate(startDate),
                    subscriptionEndDate: firebase.firestore.Timestamp.fromDate(endDate),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert(`ÄÃ£ kÃ­ch hoáº¡t subscription ${duration} thÃ¡ng!`);
                loadPartners();
            } catch (error) {
                alert('Lá»—i: ' + error.message);
            }
        }

        function viewPartner(partnerId) {
            const partner = allPartners.find(p => p.id === partnerId);
            if (!partner) return;

            const date = partner.createdAt ? new Date(partner.createdAt.toDate()).toLocaleDateString('vi-VN') : 'N/A';
            const approvedDate = partner.approvedAt ? new Date(partner.approvedAt.toDate()).toLocaleDateString('vi-VN') : 'N/A';
            const subStart = partner.subscriptionStartDate ? new Date(partner.subscriptionStartDate.toDate()).toLocaleDateString('vi-VN') : 'N/A';
            const subEnd = partner.subscriptionEndDate ? new Date(partner.subscriptionEndDate.toDate()).toLocaleDateString('vi-VN') : 'N/A';

            document.getElementById('modal-content').innerHTML = `
                <h2 style="color: var(--primary-color); margin-bottom: 1.5rem;">Chi tiáº¿t Äá»‘i tÃ¡c</h2>

                <div style="background: var(--light-color); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">ğŸ¢ ThÃ´ng tin cÃ´ng ty</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div><strong>CÃ´ng ty:</strong> ${partner.companyName}</div>
                        <div><strong>Loáº¡i hÃ¬nh:</strong> ${partner.accountType === 'company' ? 'Doanh nghiá»‡p' : 'CÃ¡ nhÃ¢n'}</div>
                        <div><strong>GÃ³i:</strong> ${partner.accountType === 'company' ? '999k/nÄƒm' : '199k/nÄƒm'}</div>
                        <div><strong>Xuáº¥t HÄ:</strong> ${partner.hasInvoice ? 'CÃ³' : 'KhÃ´ng'}</div>
                        ${partner.taxCode ? `<div><strong>MST:</strong> ${partner.taxCode}</div>` : ''}
                        <div><strong>Äá»‹a chá»‰:</strong> ${partner.address}</div>
                    </div>
                </div>

                <div style="background: #d4edda; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #28a745; margin-bottom: 1.5rem;">
                    <h3 style="color: #155724; margin-bottom: 1rem;">ğŸ‘¤ ThÃ´ng tin liÃªn há»‡</h3>
                    <div style="font-size: 1.05rem;">
                        <p style="margin-bottom: 0.75rem;"><strong>NgÆ°á»i liÃªn há»‡:</strong> ${partner.contactName}</p>
                        <p style="margin-bottom: 0.75rem;"><strong>Sá»‘ Ä‘iá»‡n thoáº¡i:</strong> <a href="tel:${partner.phone}" style="color: #007bff; font-weight: 600;">${partner.phone}</a></p>
                        <p><strong>Email:</strong> <a href="mailto:${partner.email}" style="color: #007bff;">${partner.email}</a></p>
                    </div>
                </div>

                <div style="background: #fff3cd; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">ğŸ“‹ LÄ©nh vá»±c & Khu vá»±c</h3>
                    <div>
                        <p style="margin-bottom: 0.75rem;"><strong>LÄ©nh vá»±c:</strong> ${partner.specialties ? partner.specialties.join(', ') : 'N/A'}</p>
                        <p><strong>Khu vá»±c phá»¥c vá»¥:</strong> ${partner.serviceAreas ? (partner.serviceAreas.includes('all') ? 'ToÃ n quá»‘c' : partner.serviceAreas.join(', ')) : 'N/A'}</p>
                    </div>
                </div>

                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem;">ğŸ“Š Tráº¡ng thÃ¡i</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <strong>Tráº¡ng thÃ¡i:</strong><br>
                            ${partner.status === 'approved'
                                ? '<span class="status-badge status-success">âœ“ ÄÃ£ duyá»‡t</span>'
                                : partner.status === 'pending'
                                ? '<span class="status-badge status-warning">â³ Chá» duyá»‡t</span>'
                                : '<span class="status-badge status-danger">âœ— Tá»« chá»‘i</span>'}
                        </div>
                        <div>
                            <strong>Subscription:</strong><br>
                            ${partner.subscriptionStatus === 'active'
                                ? '<span class="status-badge status-success">ğŸŸ¢ Active</span>'
                                : '<span class="status-badge status-danger">ğŸ”´ Inactive</span>'}
                        </div>
                        <div><strong>NgÃ y Ä‘Äƒng kÃ½:</strong> ${date}</div>
                        <div><strong>NgÃ y duyá»‡t:</strong> ${approvedDate}</div>
                        ${partner.subscriptionStatus === 'active' ? `
                            <div><strong>Báº¯t Ä‘áº§u:</strong> ${subStart}</div>
                            <div><strong>Káº¿t thÃºc:</strong> ${subEnd}</div>
                        ` : ''}
                        <div><strong>Tá»•ng lÆ°á»£t xem:</strong> ${partner.totalViews || 0}</div>
                        <div><strong>Tá»•ng liÃªn há»‡:</strong> ${partner.totalContacts || 0}</div>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    ${partner.status === 'pending' ? `
                        <button class="btn btn-success" onclick="closeDetailModal(); approvePartner('${partner.id}')" style="padding: 0.75rem 1.5rem; font-weight: 600; border-radius: 8px;">âœ“ Duyá»‡t Ä‘á»‘i tÃ¡c</button>
                        <button class="btn btn-danger" onclick="closeDetailModal(); rejectPartner('${partner.id}')" style="padding: 0.75rem 1.5rem; font-weight: 600; border-radius: 8px;">âœ— Tá»« chá»‘i</button>
                    ` : partner.status === 'approved' && partner.subscriptionStatus === 'inactive' ? `
                        <button class="btn btn-primary" onclick="closeDetailModal(); activateSubscription('${partner.id}')" style="padding: 0.75rem 1.5rem; font-weight: 600; border-radius: 8px;">âš¡ KÃ­ch hoáº¡t Subscription</button>
                    ` : ''}
                    <button class="btn btn-secondary" onclick="closeDetailModal()" style="padding: 0.75rem 1.5rem; font-weight: 600; border-radius: 8px;">âœ• ÄÃ³ng</button>
                </div>
            `;
            document.getElementById('detail-modal').style.display = 'block';
        }

        function closeDetailModal() {
            document.getElementById('detail-modal').style.display = 'none';
        }

        loadPartners();
    </script>
</body>
</html>
